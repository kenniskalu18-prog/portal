<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIRKACADEMY - JAMB UTME 2026 Examination Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Universal Responsive Fix */
html {
    font-size: 16px;
}

@media (max-width: 480px) {
    html {
        font-size: 14px;
    }
}

@media (max-width: 360px) {
    html {
        font-size: 12px;
    }
}

body {
    width: 100vw;
    max-width: 100%;
    overflow-x: hidden;
}

* {
    max-width: 100%;
}
            --primary: #1565C0;
            --primary-dark: #0D47A1;
            --secondary: #FF9800;
            --secondary-dark: #F57C00;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FFC107;
            --info: #2196F3;
            --light: #F5F7FA;
            --dark: #263238;
            --accent: #42A5F5;
            --light-blue: #E3F2FD;
            --cream: #FFF8E1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            width: 100%;
        }
        
       .container {
    width: 100%;
    max-width: 100vw;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    overflow: hidden;
    box-sizing: border-box;
}

@media (min-width: 768px) {
    .container {
        max-width: 95vw;
    }
}

@media (min-width: 1024px) {
    .container {
        max-width: 1200px;
    }
}
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 15px;
            text-align: center;
        }
        
        .academy-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .academy-tagline {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .exam-year {
            background: var(--secondary);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            font-size: 0.9rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px 15px;
            margin: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .hidden {
            display: none !important;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 5px;
            font-weight: 600;
            width: 100%;
            max-width: 300px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #388E3C;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #D32F2F;
        }
        
        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background: #FFA000;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-info:hover {
            background: #1976D2;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--secondary-dark);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .timer {
            background: var(--dark);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px;
            border-radius: 6px;
        }
        
        .subject-tabs {
            display: flex;
            background: var(--light);
            border-radius: 6px;
            padding: 5px;
            margin-bottom: 15px;
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        .subject-tab {
            flex: 1;
            padding: 10px 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 120px;
            font-size: 0.9rem;
        }
        
        .subject-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .subject-tab:not(.active):hover {
            background: rgba(21, 101, 192, 0.1);
        }
        
        .question-container {
            margin-bottom: 20px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light);
            flex-direction: column;
            gap: 8px;
        }
        
        .question-text {
            font-size: 1rem;
            margin-bottom: 15px;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .option {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option:hover {
            background: #f8f9fa;
            border-color: #bbb;
        }
        
        .option.selected {
            background: var(--light-blue);
            border-color: var(--primary);
        }
        
        .option-letter {
            background: #e9ecef;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }
        
     .navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.nav-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
}

.nav-buttons .btn {
    flex: 1;
    min-width: 120px;
    max-width: 200px;
    font-size: 0.9rem;
    padding: 10px 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Mobile-specific improvements */
@media (max-width: 480px) {
    .nav-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .nav-buttons .btn {
        width: 100%;
        max-width: 100%;
        min-width: auto;
        margin: 2px 0;
    }
    
    .navigation {
        gap: 5px;
    }
}

@media (max-width: 360px) {
    .nav-buttons .btn {
        font-size: 0.85rem;
        padding: 8px 10px;
    }
    
    .btn {
        font-size: 0.9rem;
        padding: 10px 15px;
    }
}

.btn-text {
    display: inline;
}

/* Hide text on very small screens, show only icons */
@media (max-width: 320px) {
    .btn-text {
        display: none;
    }
    
    .nav-btn {
        min-width: 60px !important;
    }
}
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .result-card {
            background: var(--light);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }

        
        /* IMPROVED TABLE STYLES */
        .table-container {
            overflow-x: auto;
            width: 100%;
            margin: 15px 0;
            -webkit-overflow-scrolling: touch;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.75rem;
            background: white;
        }
        
        th {
            background: var(--primary);
            color: white;
            font-size: 0.75rem;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }
        
        td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
            white-space: nowrap;
            vertical-align: middle;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* Specific column widths for better organization */
        th:nth-child(1), td:nth-child(1) { /* Rank */
            width: 50px;
            text-align: center;
        }
        
        th:nth-child(2), td:nth-child(2) { /* Name */
            min-width: 150px;
            max-width: 200px;
            white-space: normal;
            word-wrap: break-word;
        }
        
        th:nth-child(3), td:nth-child(3) { /* Reg No */
            min-width: 100px;
        }
        
        th:nth-child(4), td:nth-child(4),
        th:nth-child(5), td:nth-child(5),
        th:nth-child(6), td:nth-child(6),
        th:nth-child(7), td:nth-child(7) { /* Subject scores */
            width: 60px;
            text-align: center;
        }
        
        th:nth-child(8), td:nth-child(8) { /* Total */
            width: 80px;
            text-align: center;
            font-weight: bold;
        }
        
        th:nth-child(9), td:nth-child(9) { /* Percentage */
            width: 80px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        th:nth-child(10), td:nth-child(10) { /* Date */
            min-width: 100px;
        }
        
        th:nth-child(11), td:nth-child(11) { /* Actions */
            min-width: 120px;
            text-align: center;
        }
        
        /* Make action buttons fit better in table */
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-buttons .btn-sm {
            padding: 5px 10px;
            font-size: 0.75rem;
            white-space: nowrap;
        }
        
        /* Tablet and Desktop improvements */
        @media (min-width: 768px) {
            table {
                font-size: 0.85rem;
            }
            
            th {
                font-size: 0.85rem;
                padding: 14px 10px;
            }
            
            td {
                padding: 12px 10px;
            }
            
            .action-buttons .btn-sm {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        @media (min-width: 1024px) {
            table {
                font-size: 0.9rem;
            }
            
            th {
                font-size: 0.9rem;
            }
        }
        
        /* Mobile: Add horizontal scroll indicator */
        @media (max-width: 767px) {
            .table-container::after {
                content: '← Scroll to see more →';
                display: block;
                text-align: center;
                padding: 8px;
                background: #f8f9fa;
                font-size: 0.75rem;
                color: #666;
                font-style: italic;
            }
            
            /* Smaller font on mobile for better fit */
            table {
                font-size: 0.7rem;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
        
        /* Alternating row colors for better readability */
        tbody tr:nth-child(odd) {
            background-color: #fafafa;
        }
        
        tbody tr:nth-child(even) {
            background-color: white;
        }
        
        /* Add this to handle email column specifically in admin table */
        #adminResultsContainer td:nth-child(2) { /* Email column */
            min-width: 150px;
            max-width: 200px;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .loading {
            text-align: center;
            padding: 15px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 4px;
            margin: 8px 0;
            border-left: 4px solid #f44336;
            font-size: 0.9rem;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 4px;
            margin: 8px 0;
            border-left: 4px solid #4caf50;
            font-size: 0.9rem;
        }
        
        .admin-login {
            max-width: 100%;
            margin: 30px auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: var(--light);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .share-link {
            background: var(--light-blue);
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }
        
        .subject-card {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin: 12px 0;
            border-left: 4px solid var(--primary);
        }
        
        .strength-card {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
        }
        
        .weakness-card {
            background: #ffebee;
            border-left: 4px solid var(--danger);
        }
        
        .good-card {
            background: #fff8e1;
            border-left: 4px solid var(--warning);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #666;
        }
        
        .search-box {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
            width: auto;
        }
        
        .performance-summary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        .performance-level {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .result-analysis {
            margin: 20px 0;
        }
        
        .analysis-section {
            margin: 20px 0;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tip-list {
            padding-left: 18px;
            margin: 8px 0;
        }
        
        .tip-list li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .motivation-box {
            background: var(--cream);
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .print-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        /* Contact Information Styles */
        .contact-info {
            background: var(--light-blue);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }
        
        .contact-channels {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .contact-channel {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }
        
        @media (min-width: 768px) {
            .contact-channels {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Calculator Styles */
        .calculator-float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .calculator-float-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .calculator-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .calculator {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 320px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .calculator-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calculator-header h4 {
            margin: 0;
        }
        
        .calculator-display {
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }
        
        #calcDisplay {
            width: 100%;
            padding: 12px;
            font-size: 1.5rem;
            text-align: right;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 15px;
        }
        
        .calc-btn {
            padding: 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #f0f0f0;
            transition: all 0.2s ease;
        }
        
        .calc-btn:hover {
            background: #e0e0e0;
        }
        
        .calc-btn.operator {
            background: var(--primary-light);
            color: white;
        }
        
        .calc-btn.operator:hover {
            background: var(--primary);
        }
        
        .calc-btn.equals {
            background: var(--success);
            color: white;
        }
        
        .calc-btn.equals:hover {
            background: #388E3C;
        }
        
        .calc-btn.clear {
            background: var(--danger);
            color: white;
        }
        
        .calc-btn.clear:hover {
            background: #D32F2F;
        }

@media (max-width: 768px) {
    .calculator {
        max-width: 100%;
    }
    
    .calc-btn {
        padding: 15px;
        font-size: 1rem;
    }
    
    .calculator-display {
        font-size: 1.5rem;
        padding: 15px;
    }
}
        
        /* Tablet Styles */
        @media (min-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                max-width: 95%;
                border-radius: 12px;
            }
            
            .card {
                padding: 25px 20px;
                margin: 15px;
                border-radius: 10px;
            }
            
            header {
                padding: 25px;
            }
            
            .academy-name {
                font-size: 2.2rem;
            }
            
            .academy-tagline {
                font-size: 1.1rem;
            }
            
            .exam-year {
                font-size: 1rem;
                padding: 8px 20px;
            }
            
            .btn {
                width: auto;
                max-width: none;
            }
            
            .navigation {
                flex-direction: row;
                gap: 0;
            }
            
            .nav-buttons {
                flex-direction: row;
            }
            
            .nav-buttons .btn {
                flex: none;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .question-header {
                flex-direction: row;
                align-items: center;
                gap: 0;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px;
            }
        }
        
        /* Desktop Styles */
        @media (min-width: 1024px) {
            .container {
                max-width: 1200px;
            }
            
            .card {
                padding: 30px;
                margin: 20px;
            }
            
            header {
                padding: 30px;
            }
            
            .academy-name {
                font-size: 2.5rem;
            }
            
            .results-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .question-text {
                font-size: 1.2rem;
            }
        }
        
        /* Animation for question transitions */
        .question-transition {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Celebration animation */
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}
        
        .celebrate {
            animation: celebrate 0.5s ease 3;
        }

/* Improve mobile exam experience */
@media (max-width: 768px) {
    .exam-screen .card {
        padding: 15px 10px;
        margin: 5px;
    }
    
    .subject-tabs {
        padding: 3px;
        gap: 2px;
    }
    
    .subject-tab {
        padding: 8px 6px;
        font-size: 0.8rem;
        min-width: 80px;
    }
    
    .timer {
        margin: 5px;
        padding: 10px;
        font-size: 1.1rem;
    }
    
    .question-text {
        font-size: 1rem;
        line-height: 1.3;
    }
    
    .option {
        padding: 10px;
        font-size: 0.9rem;
    }
    
    .option-letter {
        width: 24px;
        height: 24px;
        font-size: 0.8rem;
    }
}

/* Extra small devices */
@media (max-width: 320px) {
    .subject-tab {
        padding: 6px 4px;
        font-size: 0.75rem;
        min-width: 70px;
    }
    
    .nav-buttons .btn {
        font-size: 0.8rem;
        padding: 8px;
    }
    
    .question-text {
        font-size: 0.95rem;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="academy-name">
                <i class="fas fa-graduation-cap"></i>
                SIRKACADEMY
            </div>
            <div class="academy-tagline">JAMB UTME 2026 Examination Portal</div>
            <div class="exam-year">LIVE DATABASE SYSTEM</div>
        </header>

        <!-- Welcome Screen -->
        <div class="card" id="welcomeScreen">
            <h2>Welcome to JAMB UTME Mock Examination</h2>
            <p>This examination portal collects results from ALL students across ALL devices through our centralized database system.</p>
            
            <div class="results-grid">
                <div class="result-card">
                    <h3><i class="fas fa-database"></i> Real Database</h3>
                    <p>All results stored in cloud database</p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-chart-line"></i> Live Updates</h3>
                    <p>See results from all devices instantly</p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-mobile-alt"></i> Any Device</h3>
                    <p>Phone, tablet, or computer</p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-shield-alt"></i> Secure</h3>
                    <p>One attempt per student</p>
                </div>
            </div>

            <!-- Contact Information Section -->
            <div class="contact-info">
                <h3><i class="fas fa-address-book"></i> Contact Us</h3>
                <div class="contact-channels">
                    <div class="contact-channel">
                        <i class="fab fa-whatsapp"></i>
                        <a href="https://whatsapp.com/channel/0029Vb5GW6wLCoXAAIFZLx1G" target="_blank">WhatsApp Channel</a>
                    </div>
                    <div class="contact-channel">
                        <i class="fab fa-telegram"></i>
                        <a href="https://t.me/sirkacademyonlinetutorials" target="_blank">Telegram Channel</a>
                    </div>
                    <div class="contact-channel">
                        <i class="fas fa-phone"></i>
                        <span>07073892261, 07017506151</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin: 25px 0;">
                <button class="btn" onclick="showScreen('registrationScreen')">Start Examination</button>
                <button class="btn btn-success" onclick="showScreen('allResultsScreen')">View All Results</button>
                <button class="btn btn-info" onclick="showScreen('resultCheckerScreen')">Check Your Results</button>
                <button class="btn btn-warning" onclick="showScreen('adminLoginScreen')">Admin Login</button>
            </div>
        </div>

        <!-- Registration Screen -->
        <div class="card hidden" id="registrationScreen">
            <h2>Student Registration</h2>
            <p>Please provide your details to begin the examination. All fields are required.</p>
            
            <div id="registrationError" class="error hidden"></div>
            <form id="registrationForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" required>
                </div>
                <div class="form-group">
                    <label for="regNumber">Registration Number *</label>
                    <input type="text" id="regNumber" required>
                </div>
                <button type="submit" class="btn" id="submitBtn">Start Examination</button>
                <button type="button" class="btn btn-warning" onclick="showScreen('welcomeScreen')">Cancel</button>
            </form>
        </div>

        <!-- Exam Screen -->
        <div class="card hidden" id="examScreen">
            <div class="timer" id="timer">02:00:00</div>
            
            <!-- Subject Tabs -->
            <div class="subject-tabs">
                <div class="subject-tab active" data-subject="0">
                    <i class="fas fa-font"></i> English
                </div>
                <div class="subject-tab" data-subject="1">
                    <i class="fas fa-dna"></i> Biology
                </div>
                <div class="subject-tab" data-subject="2">
                    <i class="fas fa-flask"></i> Chemistry
                </div>
                <div class="subject-tab" data-subject="3">
                    <i class="fas fa-atom"></i> Physics
                </div>
            </div>
            
            <div class="question-container question-transition">
                <div class="question-header">
                    <h3 id="currentSubject">English Language</h3>
                    <span id="questionProgress">Question 1 of 60</span>
                </div>
                
                <div class="question-text" id="questionText">Question will appear here</div>
                <div id="optionsContainer"></div>
            </div>

           <div class="navigation">
    <div class="nav-buttons">
        <button class="btn nav-btn" id="prevBtn" onclick="previousQuestion()">
            <i class="fas fa-arrow-left"></i> <span class="btn-text">Previous</span>
        </button>
        <button class="btn btn-secondary nav-btn" onclick="flagQuestion()">
            <i class="fas fa-flag"></i> <span class="btn-text">Flag</span>
        </button>
        <button class="btn nav-btn" id="nextBtn" onclick="nextQuestion()">
            <span class="btn-text">Next</span> <i class="fas fa-arrow-right"></i>
        </button>
    </div>
</div>

            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-danger" onclick="submitExam()">
                    <i class="fas fa-paper-plane"></i> Submit Examination
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="card hidden" id="resultsScreen">
            <h2>Examination Results</h2>
            <div id="studentResults"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="showScreen('welcomeScreen')">Back to Home</button>
                <button class="btn btn-success" onclick="showScreen('allResultsScreen')">View All Results</button>
                <button class="btn btn-info" onclick="showScreen('resultCheckerScreen')">Detailed Analysis</button>
            </div>
        </div>

        <!-- All Results Screen -->
        <div class="card hidden" id="allResultsScreen">
            <h2>All Examination Results</h2>
            <div id="allResultsContainer">
                <div class="loading">Loading results from database...</div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="showScreen('welcomeScreen')">Back to Home</button>
            </div>
        </div>

        <!-- Result Checker Screen -->
        <div class="card hidden" id="resultCheckerScreen">
            <h2>Check Your Results</h2>
            <p>Enter your registration number to view your detailed result analysis.</p>
            
            <div class="form-group">
                <label for="resultRegNumber">Registration Number</label>
                <input type="text" id="resultRegNumber" placeholder="Enter your registration number">
            </div>
            
            <button class="btn" onclick="checkResult()">Check Result</button>
            <button class="btn btn-warning" onclick="showScreen('welcomeScreen')">Back to Home</button>
            
            <div id="resultCheckerOutput" style="margin-top: 20px;"></div>
        </div>

        <!-- Admin Login Screen -->
        <div class="card hidden" id="adminLoginScreen">
            <div class="admin-login">
                <h2>Admin Login</h2>
                <div id="adminError" class="error hidden"></div>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn">Login</button>
                    <button type="button" class="btn btn-warning" onclick="showScreen('welcomeScreen')">Cancel</button>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div class="card hidden" id="adminDashboard">
            <h2>Admin Dashboard</h2>
            
            <div class="stats-grid" id="adminStats">
                <div class="stat-card">
                    <div class="stat-number" id="totalStudents">0</div>
                    <div>Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalExams">0</div>
                    <div>Exams Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgScore">0%</div>
                    <div>Average Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="topScore">0%</div>
                    <div>Top Score</div>
                </div>
            </div>


            <!-- Active Users Statistics -->
            <h3 style="margin-top: 20px;">Active Users Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="activeToday">0</div>
                    <div>Active Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeWeek">0</div>
                    <div>Active This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeMonth">0</div>
                    <div>Active This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeYear">0</div>
                    <div>Active This Year</div>
                </div>
            </div>

            <div class="form-group">
                <input type="text" id="searchStudents" class="search-box" placeholder="Search students by name, email, or registration number...">
            </div>

           <div style="text-align: center; margin: 15px 0; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
    <button class="btn btn-success" onclick="downloadAllResultsAsPDF()">
        <i class="fas fa-file-pdf"></i> Download All Results as PDF
    </button>
    <button class="btn btn-danger" onclick="confirmDeleteAllResults()" style="background: #D32F2F;">
        <i class="fas fa-trash-alt"></i> Delete All Results
    </button>
</div>

            <div id="adminResultsContainer">
                <div class="loading">Loading admin data...</div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-danger" onclick="logoutAdmin()">Logout</button>
            </div>
        </div>
    </div>

 <!-- Calculator Button -->
    <div class="calculator-float-btn" id="calculatorButton">
        <i class="fas fa-calculator"></i>
    </div>

    <!-- Calculator Overlay -->
    <div class="calculator-overlay" id="calculatorOverlay">
        <div class="calculator">
            <div class="calculator-header">
                <h4>Calculator</h4>
                <button class="close-modal" id="closeCalculatorBtn">&times;</button>
            </div>
            <div class="calculator-display">
                <input type="text" id="calcDisplay" readonly>
            </div>
            <div class="calculator-buttons">
                <button class="calc-btn clear" onclick="clearCalculator()">C</button>
                <button class="calc-btn clear" onclick="clearEntry()">CE</button>
                <button class="calc-btn" onclick="memoryRecall()">MR</button>
                <button class="calc-btn" onclick="memoryClear()">MC</button>
                
                <button class="calc-btn" onclick="appendToDisplay('7')">7</button>
                <button class="calc-btn" onclick="appendToDisplay('8')">8</button>
                <button class="calc-btn" onclick="appendToDisplay('9')">9</button>
                <button class="calc-btn operator" onclick="appendToDisplay('/')">÷</button>
                
                <button class="calc-btn" onclick="appendToDisplay('4')">4</button>
                <button class="calc-btn" onclick="appendToDisplay('5')">5</button>
                <button class="calc-btn" onclick="appendToDisplay('6')">6</button>
                <button class="calc-btn operator" onclick="appendToDisplay('*')">×</button>
                
                <button class="calc-btn" onclick="appendToDisplay('1')">1</button>
                <button class="calc-btn" onclick="appendToDisplay('2')">2</button>
                <button class="calc-btn" onclick="appendToDisplay('3')">3</button>
                <button class="calc-btn operator" onclick="appendToDisplay('-')">-</button>
                
                <button class="calc-btn" onclick="appendToDisplay('0')">0</button>
                <button class="calc-btn" onclick="appendToDisplay('.')">.</button>
                <button class="calc-btn equals" onclick="calculateResult()">=</button>
                <button class="calc-btn operator" onclick="appendToDisplay('+')">+</button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal" id="editStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Student Result</h3>
                <button class="close-modal" onclick="closeModal('editStudentModal')">&times;</button>
            </div>
            <div id="editStudentFormContainer"></div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
<div class="modal" id="deleteConfirmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Deletion</h3>
            <button class="close-modal" onclick="closeModal('deleteConfirmModal')">&times;</button>
        </div>
        <p id="deleteConfirmText">Are you sure you want to delete this student's result? This action cannot be undone.</p>
        <div style="text-align: right; margin-top: 20px;">
            <button class="btn btn-warning" onclick="closeModal('deleteConfirmModal')">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
    </div>
</div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://ktpwcxrwptzrgyyadldj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0cHdjeHJ3cHR6cmd5eWFkbGRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNzAyNjgsImV4cCI6MjA3Nzk0NjI2OH0.j7ZiEH6EgpZIA2OMTDvAvN_X3G_qlCdrUSjZrrFWeWM';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Exam Configuration
        const examConfig = {
            duration: 2 * 60 * 60, // 2 hours in seconds
            subjects: [
                { name: 'English Language', questions: 60, startIndex: 0, maxScore: 100 },
                { name: 'Biology', questions: 40, startIndex: 60, maxScore: 100 },
                { name: 'Chemistry', questions: 40, startIndex: 100, maxScore: 100 },
                { name: 'Physics', questions: 40, startIndex: 140, maxScore: 100 }
            ],
            totalQuestions: 180,
            totalMarks: 400
        };

        // COMPLETE JAMB QUESTIONS - ALL 180 QUESTIONS
        const questions = [
    // ENGLISH LANGUAGE (60 questions)
    { id: 1, subject: 0, text: "Choose the word opposite in meaning to 'AFFLUENT':", options: ["Wealthy", "Poor", "Rich", "Prosperous"], answer: 1 },
    { id: 2, subject: 0, text: "Which of the following is a conjunction?", options: ["Run", "And", "Beautiful", "Happy"], answer: 1 },
    { id: 3, subject: 0, text: "Identify the noun: 'She sings beautifully'", options: ["She", "sings", "beautifully", "None"], answer: 0 },
    { id: 4, subject: 0, text: "Choose the correct spelling:", options: ["Occured", "Occurred", "Ocurred", "Occurrd"], answer: 1 },
    { id: 5, subject: 0, text: "What is the synonym of 'TRANSPARENT'?", options: ["Opaque", "Clear", "Solid", "Dense"], answer: 1 },
    { id: 6, subject: 0, text: "Which sentence is correct?", options: ["He don't know", "He doesn't knows", "He doesn't know", "He not know"], answer: 2 },
    { id: 7, subject: 0, text: "Choose the correct punctuation: 'John said I am tired'", options: ["John said, 'I am tired.'", "John said I am tired", "John said; I am tired", "John said I am tired."], answer: 0 },
    { id: 8, subject: 0, text: "Identify the simile:", options: ["The stars danced", "As cold as ice", "Time is money", "The wind howled"], answer: 1 },
    { id: 9, subject: 0, text: "Which is an adverb?", options: ["Quick", "Quickly", "Quickness", "Quicker"], answer: 1 },
    { id: 10, subject: 0, text: "Choose the correct form: 'Each of the students ___ present'", options: ["are", "is", "were", "have"], answer: 1 },
    { id: 11, subject: 0, text: "What is the plural of 'sheep'?", options: ["Sheeps", "Sheep", "Sheepes", "Sheepen"], answer: 1 },
    { id: 12, subject: 0, text: "Identify the tense: 'She has been singing for hours'", options: ["Present Perfect", "Present Perfect Continuous", "Past Perfect", "Simple Present"], answer: 1 },
    { id: 13, subject: 0, text: "Choose the word that rhymes with 'LIGHT':", options: ["Eight", "Right", "Height", "Wait"], answer: 1 },
    { id: 14, subject: 0, text: "Which is a concrete noun?", options: ["Love", "Chair", "Wisdom", "Justice"], answer: 1 },
    { id: 15, subject: 0, text: "Select the correct sentence:", options: ["Your a good friend", "You're a good friend", "Your'e a good friend", "Youre a good friend"], answer: 1 },
    { id: 16, subject: 0, text: "What does 'PROCRASTINATE' mean?", options: ["To delay", "To hurry", "To complete", "To organize"], answer: 0 },
    { id: 17, subject: 0, text: "Identify the indirect object: 'She sent him a letter'", options: ["She", "sent", "him", "letter"], answer: 2 },
    { id: 18, subject: 0, text: "Choose the appropriate preposition: 'She is afraid ___ spiders'", options: ["of", "from", "with", "by"], answer: 0 },
    { id: 19, subject: 0, text: "What is the past tense of 'go'?", options: ["Goed", "Went", "Gone", "Going"], answer: 1 },
    { id: 20, subject: 0, text: "Which is a synonym for 'ANCIENT'?", options: ["Modern", "New", "Old", "Recent"], answer: 2 },
    { id: 21, subject: 0, text: "Identify the clause: 'Although it rained, we went out'", options: ["Noun clause", "Adjective clause", "Adverb clause", "Main clause"], answer: 2 },
    { id: 22, subject: 0, text: "Choose the correct tag: 'They are coming, ___?'", options: ["are they", "aren't they", "do they", "don't they"], answer: 1 },
    { id: 23, subject: 0, text: "What is a narrative told by a character in the story called?", options: ["Third person", "First person", "Omniscient", "Objective"], answer: 1 },
    { id: 24, subject: 0, text: "Select the correct sentence:", options: ["Neither of them are ready", "Neither of them is ready", "Neither of them were ready", "Neither of them be ready"], answer: 1 },
    { id: 25, subject: 0, text: "Which word is stressed on the first syllable?", options: ["hoTEL", "COMputer", "reMEMber", "beGIN"], answer: 1 },
    { id: 26, subject: 0, text: "What does 'VERBOSE' mean?", options: ["Brief", "Wordy", "Clear", "Silent"], answer: 1 },
    { id: 27, subject: 0, text: "Change to passive: 'The dog bit the man'", options: ["The man was bitten by the dog", "The man bit the dog", "The dog was bit by the man", "The man is bitten"], answer: 0 },
    { id: 28, subject: 0, text: "Choose the superlative form: 'This is the ___ book I've read'", options: ["good", "better", "best", "well"], answer: 2 },
    { id: 29, subject: 0, text: "Which is an example of alliteration?", options: ["Peter Piper picked", "He runs fast", "The sun is bright", "I am happy"], answer: 0 },
    { id: 30, subject: 0, text: "Select the correct word: 'I need ___ advice'", options: ["a", "an", "some", "many"], answer: 2 },
    { id: 31, subject: 0, text: "What is the antonym of 'GENEROUS'?", options: ["Kind", "Selfish", "Giving", "Caring"], answer: 1 },
    { id: 32, subject: 0, text: "Identify the phrase: 'The book on the table is mine'", options: ["Noun phrase", "Verb phrase", "Prepositional phrase", "Adjectival phrase"], answer: 2 },
    { id: 33, subject: 0, text: "Choose the word meaning 'to make better':", options: ["Worsen", "Improve", "Damage", "Destroy"], answer: 1 },
    { id: 34, subject: 0, text: "Which expresses a wish?", options: ["I go", "I went", "I wish I could go", "I will go"], answer: 2 },
    { id: 35, subject: 0, text: "What is the plural of 'criterion'?", options: ["Criterions", "Criteria", "Criterias", "Criterion"], answer: 1 },
    { id: 36, subject: 0, text: "Identify: 'Life is a journey'", options: ["Simile", "Metaphor", "Personification", "Hyperbole"], answer: 1 },
    { id: 37, subject: 0, text: "Choose correct: 'The meeting will ___ tomorrow'", options: ["hold", "be held", "held", "holding"], answer: 1 },
    { id: 38, subject: 0, text: "Which is a complex sentence?", options: ["I eat", "I eat and drink", "When I eat, I drink", "I, eating"], answer: 2 },
    { id: 39, subject: 0, text: "What does 'AMBIGUOUS' mean?", options: ["Clear", "Unclear", "Certain", "Obvious"], answer: 1 },
    { id: 40, subject: 0, text: "Spot the error: 'Me and him went to school'", options: ["Me", "and", "him", "No error"], answer: 0 },
    { id: 41, subject: 0, text: "Correct form: 'If he ___ harder, he would pass'", options: ["study", "studies", "studied", "studying"], answer: 2 },
    { id: 42, subject: 0, text: "Synonym of 'ELOQUENT':", options: ["Articulate", "Silent", "Confused", "Unclear"], answer: 0 },
    { id: 43, subject: 0, text: "Identify mood: 'Go away!'", options: ["Indicative", "Imperative", "Subjunctive", "Conditional"], answer: 1 },
    { id: 44, subject: 0, text: "Meaning of 'EXCLUDE':", options: ["Include", "Leave out", "Add", "Join"], answer: 1 },
    { id: 45, subject: 0, text: "Correct usage:", options: ["Less people came", "Fewer people came", "Lesser people came", "Few people came"], answer: 1 },
    { id: 46, subject: 0, text: "Adjective form of 'beauty':", options: ["Beautify", "Beautiful", "Beautifully", "Beauteous"], answer: 1 },
    { id: 47, subject: 0, text: "Type of conjunction in 'and':", options: ["Coordinating", "Subordinating", "Correlative", "Conjunctive"], answer: 0 },
    { id: 48, subject: 0, text: "Correct comparison: 'She is ___ than me'", options: ["smart", "smarter", "smartest", "more smart"], answer: 1 },
    { id: 49, subject: 0, text: "Meaning of 'NOSTALGIA':", options: ["Future hope", "Past longing", "Present joy", "Current fear"], answer: 1 },
    { id: 50, subject: 0, text: "Correct: 'They took ___ books'", options: ["there", "their", "they're", "thier"], answer: 1 },
    { id: 51, subject: 0, text: "Figure of speech: 'The classroom was a zoo'", options: ["Simile", "Metaphor", "Alliteration", "Personification"], answer: 1 },
    { id: 52, subject: 0, text: "Correct verb: 'The team ___ won'", options: ["have", "has", "are", "were"], answer: 1 },
    { id: 53, subject: 0, text: "Antonym of 'COURAGE':", options: ["Bravery", "Fear", "Strength", "Power"], answer: 1 },
    { id: 54, subject: 0, text: "Example of irony:", options: ["Hot as fire", "A fire station burns down", "Happy birthday", "Running fast"], answer: 1 },
    { id: 55, subject: 0, text: "Correct tense: 'By next year, I ___ graduate'", options: ["will have", "have", "had", "will"], answer: 0 },
    { id: 56, subject: 0, text: "Meaning of 'METICULOUS':", options: ["Careless", "Careful", "Quick", "Slow"], answer: 1 },
    { id: 57, subject: 0, text: "Sentence type: 'What a beautiful day!'", options: ["Declarative", "Interrogative", "Imperative", "Exclamatory"], answer: 3 },
    { id: 58, subject: 0, text: "Correct preposition: 'She is interested ___ music'", options: ["at", "in", "on", "by"], answer: 1 },
    { id: 59, subject: 0, text: "Meaning of 'RECONCILE':", options: ["Fight", "Make peace", "Argue", "Separate"], answer: 1 },
    { id: 60, subject: 0, text: "Literary device: 'He's a walking encyclopedia'", options: ["Simile", "Metaphor", "Irony", "Allusion"], answer: 1 },

    // BIOLOGY (40 questions)
    { id: 61, subject: 1, text: "Which organelle is the powerhouse of the cell?", options: ["Nucleus", "Mitochondria", "Ribosome", "Golgi body"], answer: 1 },
    { id: 62, subject: 1, text: "What is the functional unit of the kidney?", options: ["Neuron", "Nephron", "Alveolus", "Villus"], answer: 1 },
    { id: 63, subject: 1, text: "Which blood group is universal recipient?", options: ["A", "B", "O", "AB"], answer: 3 },
    { id: 64, subject: 1, text: "The green pigment in plants is called:", options: ["Chlorophyll", "Carotene", "Xanthophyll", "Hemoglobin"], answer: 0 },
    { id: 65, subject: 1, text: "What is the process of cell eating called?", options: ["Pinocytosis", "Phagocytosis", "Osmosis", "Diffusion"], answer: 1 },
    { id: 66, subject: 1, text: "Which enzyme digests protein?", options: ["Amylase", "Lipase", "Pepsin", "Maltase"], answer: 2 },
    { id: 67, subject: 1, text: "The type of blood vessel that carries blood away from the heart is:", options: ["Vein", "Artery", "Capillary", "Venule"], answer: 1 },
    { id: 68, subject: 1, text: "Which of these is an example of adaptation?", options: ["Sleeping", "Camel's hump", "Running", "Eating"], answer: 1 },
    { id: 69, subject: 1, text: "The male gamete in plants is:", options: ["Ovule", "Pollen", "Seed", "Fruit"], answer: 1 },
    { id: 70, subject: 1, text: "Mitosis results in how many daughter cells?", options: ["1", "2", "4", "8"], answer: 1 },
    { id: 71, subject: 1, text: "Which structure protects the brain?", options: ["Rib cage", "Skull", "Vertebra", "Sternum"], answer: 1 },
    { id: 72, subject: 1, text: "The enzyme that converts starch to maltose is:", options: ["Pepsin", "Amylase", "Lipase", "Trypsin"], answer: 1 },
    { id: 73, subject: 1, text: "Which vitamin prevents scurvy?", options: ["Vitamin A", "Vitamin B", "Vitamin C", "Vitamin D"], answer: 2 },
    { id: 74, subject: 1, text: "The longest bone in human body is:", options: ["Humerus", "Tibia", "Femur", "Fibula"], answer: 2 },
    { id: 75, subject: 1, text: "Which organism is a producer?", options: ["Grass", "Grasshopper", "Frog", "Snake"], answer: 0 },
    { id: 76, subject: 1, text: "Respiration in plants occurs in:", options: ["Day only", "Night only", "Day and night", "Never"], answer: 2 },
    { id: 77, subject: 1, text: "Which gas is released during photosynthesis?", options: ["Oxygen", "Nitrogen", "Carbon dioxide", "Hydrogen"], answer: 0 },
    { id: 78, subject: 1, text: "The female reproductive organ of a flower is:", options: ["Stamen", "Pistil", "Petal", "Sepal"], answer: 1 },
    { id: 79, subject: 1, text: "Which type of joint is found in the elbow?", options: ["Ball and socket", "Hinge", "Pivot", "Gliding"], answer: 1 },
    { id: 80, subject: 1, text: "The study of insects is called:", options: ["Entomology", "Ornithology", "Ichthyology", "Herpetology"], answer: 0 },
    { id: 81, subject: 1, text: "Which is NOT a function of the liver?", options: ["Bile production", "Glycogen storage", "Urea formation", "Insulin production"], answer: 3 },
    { id: 82, subject: 1, text: "DNA is found in which part of the cell?", options: ["Cytoplasm", "Nucleus", "Cell membrane", "Vacuole"], answer: 1 },
    { id: 83, subject: 1, text: "The valve between left atrium and ventricle is:", options: ["Tricuspid", "Bicuspid", "Pulmonary", "Aortic"], answer: 1 },
    { id: 84, subject: 1, text: "Evolution is mainly driven by:", options: ["Migration", "Natural selection", "Mutation only", "Isolation only"], answer: 1 },
    { id: 85, subject: 1, text: "Which disease is caused by mosquito?", options: ["Typhoid", "Cholera", "Malaria", "Tuberculosis"], answer: 2 },
    { id: 86, subject: 1, text: "The part of brain that controls heartbeat is:", options: ["Cerebrum", "Cerebellum", "Medulla oblongata", "Hypothalamus"], answer: 2 },
    { id: 87, subject: 1, text: "Which gas contributes most to global warming?", options: ["Oxygen", "Nitrogen", "Carbon dioxide", "Argon"], answer: 2 },
    { id: 88, subject: 1, text: "Meiosis produces how many cells?", options: ["1", "2", "4", "8"], answer: 2 },
    { id: 89, subject: 1, text: "The respiratory organ in fish is:", options: ["Lung", "Gill", "Skin", "Trachea"], answer: 1 },
    { id: 90, subject: 1, text: "Genes are segments of:", options: ["RNA", "DNA", "Protein", "Lipid"], answer: 1 },
    { id: 91, subject: 1, text: "An example of a vestigial organ in humans is:", options: ["Heart", "Appendix", "Liver", "Kidney"], answer: 1 },
    { id: 92, subject: 1, text: "Plants bend towards light due to:", options: ["Geotropism", "Phototropism", "Hydrotropism", "Chemotropism"], answer: 1 },
    { id: 93, subject: 1, text: "Which gland produces insulin?", options: ["Liver", "Pancreas", "Thyroid", "Pituitary"], answer: 1 },
    { id: 94, subject: 1, text: "The relationship between bee and flower is:", options: ["Parasitism", "Commensalism", "Mutualism", "Competition"], answer: 2 },
    { id: 95, subject: 1, text: "Which is a non-renewable resource?", options: ["Solar", "Wind", "Coal", "Water"], answer: 2 },
    { id: 96, subject: 1, text: "Movement of water across membrane is:", options: ["Osmosis", "Diffusion", "Active transport", "Facilitated diffusion"], answer: 0 },
    { id: 97, subject: 1, text: "The primary source of energy in ecosystem is:", options: ["Producers", "Consumers", "Sun", "Decomposers"], answer: 2 },
    { id: 98, subject: 1, text: "Which part of eye controls light entry?", options: ["Retina", "Iris", "Lens", "Cornea"], answer: 1 },
    { id: 99, subject: 1, text: "Red blood cells are produced in:", options: ["Liver", "Spleen", "Bone marrow", "Kidney"], answer: 2 },
    { id: 100, subject: 1, text: "The substance that makes plant cell wall rigid is:", options: ["Chitin", "Cellulose", "Pectin", "Lignin"], answer: 1 },

    // CHEMISTRY (40 questions)
    { id: 101, subject: 2, text: "What is the symbol for potassium?", options: ["P", "K", "Pt", "Po"], answer: 1 },
    { id: 102, subject: 2, text: "Which is NOT a state of matter?", options: ["Solid", "Liquid", "Gas", "Energy"], answer: 3 },
    { id: 103, subject: 2, text: "The pH of pure water is:", options: ["0", "7", "14", "1"], answer: 1 },
    { id: 104, subject: 2, text: "Which element has symbol 'Fe'?", options: ["Fluorine", "Iron", "Fermium", "Lead"], answer: 1 },
    { id: 105, subject: 2, text: "Formula for ammonia is:", options: ["NH3", "NH4", "N2H", "H3N"], answer: 0 },
    { id: 106, subject: 2, text: "Which is an element?", options: ["Water", "Salt", "Oxygen", "Sugar"], answer: 2 },
    { id: 107, subject: 2, text: "The process of liquid to gas is called:", options: ["Melting", "Freezing", "Evaporation", "Condensation"], answer: 2 },
    { id: 108, subject: 2, text: "Which particle has positive charge?", options: ["Proton", "Neutron", "Electron", "Photon"], answer: 0 },
    { id: 109, subject: 2, text: "Valency of calcium is:", options: ["1", "2", "3", "4"], answer: 1 },
    { id: 110, subject: 2, text: "Which is a base?", options: ["HCl", "H2SO4", "NaOH", "HNO3"], answer: 2 },
    { id: 111, subject: 2, text: "Reaction that absorbs heat is:", options: ["Endothermic", "Exothermic", "Isothermic", "Adiabatic"], answer: 0 },
    { id: 112, subject: 2, text: "What is produced when acid reacts with metal?", options: ["Oxygen", "Hydrogen", "Nitrogen", "Carbon dioxide"], answer: 1 },
    { id: 113, subject: 2, text: "Molar mass is measured in:", options: ["g", "g/mol", "mol", "L"], answer: 1 },
    { id: 114, subject: 2, text: "Which gas causes acid rain?", options: ["Oxygen", "Nitrogen", "Sulfur dioxide", "Argon"], answer: 2 },
    { id: 115, subject: 2, text: "Separation of crude oil is done by:", options: ["Filtration", "Distillation", "Crystallization", "Sublimation"], answer: 1 },
    { id: 116, subject: 2, text: "Most abundant element in universe is:", options: ["Oxygen", "Hydrogen", "Carbon", "Nitrogen"], answer: 1 },
    { id: 117, subject: 2, text: "Chemical formula for glucose is:", options: ["C6H12O6", "C12H22O11", "CH4", "C2H5OH"], answer: 0 },
    { id: 118, subject: 2, text: "Metals are generally:", options: ["Brittle", "Good conductors", "Insulators", "Dull"], answer: 1 },
    { id: 119, subject: 2, text: "A solution with pH 3 is:", options: ["Basic", "Neutral", "Acidic", "Alkaline"], answer: 2 },
    { id: 120, subject: 2, text: "Which gas is used in making fertilizers?", options: ["Oxygen", "Hydrogen", "Nitrogen", "Chlorine"], answer: 2 },
    { id: 121, subject: 2, text: "Atomic number represents number of:", options: ["Neutrons", "Protons", "Electrons", "Nucleons"], answer: 1 },
    { id: 122, subject: 2, text: "Which is a chemical change?", options: ["Melting", "Boiling", "Rusting", "Dissolving"], answer: 2 },
    { id: 123, subject: 2, text: "Law of conservation of mass was stated by:", options: ["Dalton", "Lavoisier", "Avogadro", "Boyle"], answer: 1 },
    { id: 124, subject: 2, text: "Neutrons are found in:", options: ["Electron cloud", "Nucleus", "Orbit", "Outside atom"], answer: 1 },
    { id: 125, subject: 2, text: "Formula for nitric acid is:", options: ["HNO3", "HNO2", "H2NO3", "HN3"], answer: 0 },
    { id: 126, subject: 2, text: "Which is a noble gas?", options: ["Hydrogen", "Oxygen", "Neon", "Nitrogen"], answer: 2 },
    { id: 127, subject: 2, text: "Oxidation involves:", options: ["Gain of electrons", "Loss of electrons", "Gain of protons", "Loss of neutrons"], answer: 1 },
    { id: 128, subject: 2, text: "Which gas is used in fire extinguishers?", options: ["Oxygen", "Hydrogen", "Carbon dioxide", "Nitrogen"], answer: 2 },
    { id: 129, subject: 2, text: "Symbol for silver is:", options: ["Si", "Ag", "Au", "Al"], answer: 1 },
    { id: 130, subject: 2, text: "Which has pH greater than 7?", options: ["Acid", "Base", "Neutral", "Salt"], answer: 1 },
    { id: 131, subject: 2, text: "In neutral atom, electrons equal:", options: ["Protons", "Neutrons", "Protons + neutrons", "Neutrons - protons"], answer: 0 },
    { id: 132, subject: 2, text: "Hard water is softened by:", options: ["Boiling", "Distillation", "Ion exchange", "Filtration"], answer: 2 },
    { id: 133, subject: 2, text: "Ethanol formula is:", options: ["CH4", "C2H6", "C2H5OH", "CH3OH"], answer: 2 },
    { id: 134, subject: 2, text: "Which is a transition element?", options: ["Sodium", "Magnesium", "Copper", "Calcium"], answer: 2 },
    { id: 135, subject: 2, text: "Boiling point of water is:", options: ["0°C", "100°C", "50°C", "150°C"], answer: 1 },
    { id: 136, subject: 2, text: "Photosynthesis requires:", options: ["Oxygen", "Carbon dioxide", "Nitrogen", "Argon"], answer: 1 },
    { id: 137, subject: 2, text: "Dry ice is solid:", options: ["Water", "Carbon dioxide", "Oxygen", "Nitrogen"], answer: 1 },
    { id: 138, subject: 2, text: "Which is homogeneous mixture?", options: ["Sand and water", "Oil and water", "Salt solution", "Soil"], answer: 2 },
    { id: 139, subject: 2, text: "Reduction is:", options: ["Loss of electrons", "Gain of electrons", "Loss of protons", "Gain of neutrons"], answer: 1 },
    { id: 140, subject: 2, text: "Most electronegative element is:", options: ["Oxygen", "Fluorine", "Chlorine", "Nitrogen"], answer: 1 },

    // PHYSICS (40 questions)
    { id: 141, subject: 3, text: "SI unit of force is:", options: ["Joule", "Newton", "Watt", "Pascal"], answer: 1 },
    { id: 142, subject: 3, text: "Which is a vector?", options: ["Mass", "Temperature", "Force", "Speed"], answer: 2 },
    { id: 143, subject: 3, text: "Rate of change of displacement is:", options: ["Speed", "Velocity", "Acceleration", "Force"], answer: 1 },
    { id: 144, subject: 3, text: "Value of g is approximately:", options: ["9.8 m/s²", "10 m/s", "9.8 m/s", "98 m/s²"], answer: 0 },
    { id: 145, subject: 3, text: "Newton's third law states:", options: ["F=ma", "Action and reaction", "Inertia", "Gravity"], answer: 1 },
    { id: 146, subject: 3, text: "SI unit of work is:", options: ["Newton", "Joule", "Watt", "Pascal"], answer: 1 },
    { id: 147, subject: 3, text: "Best conductor of electricity:", options: ["Wood", "Plastic", "Silver", "Glass"], answer: 2 },
    { id: 148, subject: 3, text: "Bending of light is:", options: ["Reflection", "Refraction", "Diffraction", "Interference"], answer: 1 },
    { id: 149, subject: 3, text: "Unit of current is:", options: ["Volt", "Ampere", "Ohm", "Coulomb"], answer: 1 },
    { id: 150, subject: 3, text: "Longest wavelength visible light:", options: ["Violet", "Blue", "Green", "Red"], answer: 3 },
    { id: 151, subject: 3, text: "Energy in compressed spring is:", options: ["Kinetic", "Potential", "Thermal", "Nuclear"], answer: 1 },
    { id: 152, subject: 3, text: "Speed of light is:", options: ["3 × 10^6 m/s", "3 × 10^8 m/s", "3 × 10^10 m/s", "3 × 10^5 m/s"], answer: 1 },
    { id: 153, subject: 3, text: "Which is ionizing radiation?", options: ["Radio waves", "Microwaves", "Gamma rays", "Infrared"], answer: 2 },
    { id: 154, subject: 3, text: "Unit of power is:", options: ["Joule", "Watt", "Newton", "Ampere"], answer: 1 },
    { id: 155, subject: 3, text: "Density formula is:", options: ["Mass × Volume", "Mass ÷ Volume", "Volume ÷ Mass", "Mass + Volume"], answer: 1 },
    { id: 156, subject: 3, text: "Boyle's law relates:", options: ["P and V", "V and T", "P and T", "n and V"], answer: 0 },
    { id: 157, subject: 3, text: "Unit of resistance is:", options: ["Volt", "Ampere", "Ohm", "Watt"], answer: 2 },
    { id: 158, subject: 3, text: "Which is renewable?", options: ["Coal", "Oil", "Wind", "Gas"], answer: 2 },
    { id: 159, subject: 3, text: "Change from liquid to gas at boiling point:", options: ["Evaporation", "Vaporization", "Condensation", "Sublimation"], answer: 1 },
    { id: 160, subject: 3, text: "Pascal's principle applies to:", options: ["Gases", "Liquids", "Solids", "Plasma"], answer: 1 },
    { id: 161, subject: 3, text: "Concave mirror can form:", options: ["Only real images", "Only virtual images", "Both real and virtual", "No images"], answer: 2 },
    { id: 162, subject: 3, text: "Unit of frequency is:", options: ["Hertz", "Decibel", "Newton", "Joule"], answer: 0 },
    { id: 163, subject: 3, text: "Work = Force ×:", options: ["Time", "Distance", "Mass", "Velocity"], answer: 1 },
    { id: 164, subject: 3, text: "Example of first class lever:", options: ["Wheelbarrow", "Nutcracker", "Seesaw", "Bottle opener"], answer: 2 },
    { id: 165, subject: 3, text: "Amount of matter in object:", options: ["Weight", "Mass", "Volume", "Density"], answer: 1 },
    { id: 166, subject: 3, text: "Unit of charge is:", options: ["Volt", "Ampere", "Coulomb", "Ohm"], answer: 2 },
    { id: 167, subject: 3, text: "Charles's law relates:", options: ["P and V", "V and T", "P and T", "P and n"], answer: 1 },
    { id: 168, subject: 3, text: "Resistance depends on:", options: ["Length only", "Area only", "Material only", "All of these"], answer: 3 },
    { id: 169, subject: 3, text: "Energy cannot be:", options: ["Transferred", "Transformed", "Created or destroyed", "Stored"], answer: 2 },
    { id: 170, subject: 3, text: "Myopia is corrected by:", options: ["Convex lens", "Concave lens", "Prism", "Mirror"], answer: 1 },
    { id: 171, subject: 3, text: "Unit of pressure is:", options: ["Newton", "Pascal", "Joule", "Watt"], answer: 1 },
    { id: 172, subject: 3, text: "Speed = Distance ÷:", options: ["Time", "Mass", "Force", "Acceleration"], answer: 0 },
    { id: 173, subject: 3, text: "Which is scalar?", options: ["Force", "Velocity", "Acceleration", "Energy"], answer: 3 },
    { id: 174, subject: 3, text: "Sound bending around obstacles:", options: ["Reflection", "Refraction", "Diffraction", "Absorption"], answer: 2 },
    { id: 175, subject: 3, text: "Unit of capacitance is:", options: ["Ohm", "Farad", "Henry", "Tesla"], answer: 1 },
    { id: 176, subject: 3, text: "Fission occurs in:", options: ["Battery", "Solar cell", "Nuclear reactor", "Generator"], answer: 2 },
    { id: 177, subject: 3, text: "Force opposing motion:", options: ["Gravity", "Friction", "Tension", "Normal force"], answer: 1 },
    { id: 178, subject: 3, text: "Ohm's law is:", options: ["V = I/R", "V = IR", "I = VR", "R = VI"], answer: 1 },
    { id: 179, subject: 3, text: "Energy in battery:", options: ["Kinetic", "Potential", "Chemical", "Nuclear"], answer: 2 },
    { id: 180, subject: 3, text: "Unit of magnetic flux is:", options: ["Tesla", "Weber", "Henry", "Gauss"], answer: 1 }
];

        // Global variables
        let currentStudent = null;
        let currentQuestionIndex = 0;
        let studentAnswers = Array(examConfig.totalQuestions).fill(null);
        let flaggedQuestions = new Set();
        let timerInterval = null;
        let timeRemaining = examConfig.duration;

         // Calculator variables
        let calculatorMemory = 0;

        // DOM Elements
        const screens = {
            welcome: document.getElementById('welcomeScreen'),
            registration: document.getElementById('registrationScreen'),
            exam: document.getElementById('examScreen'),
            results: document.getElementById('resultsScreen'),
            allResults: document.getElementById('allResultsScreen'),
            resultChecker: document.getElementById('resultCheckerScreen'),
            adminLogin: document.getElementById('adminLoginScreen'),
            adminDashboard: document.getElementById('adminDashboard')
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('registrationForm').addEventListener('submit', handleRegistration);
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            
            // Initialize subject tabs
            document.querySelectorAll('.subject-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const subjectIndex = parseInt(this.getAttribute('data-subject'));
                    switchSubject(subjectIndex);
                });
            });
            
            // Check if student is already registered
            const savedStudent = localStorage.getItem('currentStudent');
            if (savedStudent) {
                currentStudent = JSON.parse(savedStudent);
                showScreen('examScreen');
                startExam();
            }
            
            // Load all results if on results screen
            if (window.location.hash === '#results') {
                showScreen('allResultsScreen');
                loadAllResults();
            }
        });

 // Calculator
            document.getElementById('calculatorButton').addEventListener('click', openCalculator);
            document.getElementById('closeCalculatorBtn').addEventListener('click', closeCalculator);
            document.getElementById('calculatorOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCalculator();
                }
            });

        // Screen navigation
        function showScreen(screenId) {
            // Hide all screens
            Object.values(screens).forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show the requested screen
            document.getElementById(screenId).classList.remove('hidden');
            
            // Perform screen-specific initializations
            switch(screenId) {
                case 'allResultsScreen':
                    loadAllResults();
                    break;
                case 'adminDashboard':
                    loadAdminDashboard();
                    break;
                case 'resultCheckerScreen':
                    document.getElementById('resultCheckerOutput').innerHTML = '';
                    break;
            }
        }

        // Student registration
        async function handleRegistration(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const errorDiv = document.getElementById('registrationError');
            
            // Get form data
            const studentData = {
                full_name: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                registration_number: document.getElementById('regNumber').value.trim(),
                created_at: new Date().toISOString()
            };
            
            // Validate form
            if (!studentData.full_name || !studentData.email || !studentData.phone || !studentData.registration_number) {
                errorDiv.textContent = 'All fields are required.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(studentData.email)) {
                errorDiv.textContent = 'Please enter a valid email address.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Check if registration number already exists
            try {
                const { data: existingStudent, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('registration_number', studentData.registration_number)
                    .single();
                
                if (existingStudent) {
                    errorDiv.textContent = 'This registration number has already been used. Each student can only take the exam once.';
                    errorDiv.classList.remove('hidden');
                    return;
                }
            } catch (error) {
                // No existing student found, which is good
            }
            
            // Disable submit button to prevent double submission
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering...';
            
            try {
                // Insert student into database
                const { data, error } = await supabase
                    .from('students')
                    .insert([studentData])
                    .select();
                
                if (error) {
                    throw error;
                }
                
                // Save student data locally
                currentStudent = data[0];
                localStorage.setItem('currentStudent', JSON.stringify(currentStudent));
                
                // Show exam screen
                showScreen('examScreen');
                startExam();
                
            } catch (error) {
                console.error('Registration error:', error);
                errorDiv.textContent = 'Registration failed. Please try again. Error: ' + error.message;
                errorDiv.classList.remove('hidden');
                
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Start Examination';
            }
        }

        // Start the exam
        function startExam() {
            // Reset exam state
            currentQuestionIndex = 0;
            studentAnswers = Array(examConfig.totalQuestions).fill(null);
            flaggedQuestions = new Set();
            timeRemaining = examConfig.duration;
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion(currentQuestionIndex);
            
            // Initialize subject tabs
            switchSubject(0);
        }

        // Timer functions
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = timeRemaining % 60;
            
            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running low
            if (timeRemaining < 300) { // 5 minutes
                document.getElementById('timer').style.background = 'var(--danger)';
            } else if (timeRemaining < 600) { // 10 minutes
                document.getElementById('timer').style.background = 'var(--warning)';
                document.getElementById('timer').style.color = 'var(--dark)';
            }
        }

        // Question navigation
        function loadQuestion(index) {
            if (index < 0 || index >= examConfig.totalQuestions) return;
            
            currentQuestionIndex = index;
            const question = questions[index];
            
            // Update question text
            document.getElementById('questionText').textContent = question.text;
            
            // Update progress
            document.getElementById('questionProgress').textContent = 
                `Question ${index + 1} of ${examConfig.totalQuestions}`;
            
            // Update options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, optionIndex) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (studentAnswers[index] === optionIndex) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + optionIndex)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(optionIndex));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === examConfig.totalQuestions - 1;
            
            // Update flagged status
            const flagBtn = document.querySelector('.btn-secondary');
            if (flaggedQuestions.has(index)) {
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> Unflag Question';
            } else {
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> Flag Question';
            }
            
            // Add transition effect
            const container = document.querySelector('.question-container');
            container.classList.remove('question-transition');
            void container.offsetWidth; // Trigger reflow
            container.classList.add('question-transition');
        }

        function selectOption(optionIndex) {
            studentAnswers[currentQuestionIndex] = optionIndex;
            loadQuestion(currentQuestionIndex); // Reload to update UI
        }

        function flagQuestion() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flaggedQuestions.delete(currentQuestionIndex);
            } else {
                flaggedQuestions.add(currentQuestionIndex);
            }
            loadQuestion(currentQuestionIndex); // Reload to update UI
        }

        function nextQuestion() {
            if (currentQuestionIndex < examConfig.totalQuestions - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        function switchSubject(subjectIndex) {
            // Update active tab
            document.querySelectorAll('.subject-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.subject-tab[data-subject="${subjectIndex}"]`).classList.add('active');
            
            // Update subject name
            document.getElementById('currentSubject').textContent = examConfig.subjects[subjectIndex].name;
            
            // Find first question of this subject
            const firstQuestionIndex = examConfig.subjects[subjectIndex].startIndex;
            loadQuestion(firstQuestionIndex);
        }

        // Submit exam and calculate results
        async function submitExam() {
            clearInterval(timerInterval);
            
            // Calculate scores
            const scores = calculateScores();
            const totalScore = scores.reduce((sum, score) => sum + score, 0);
            const percentage = Math.round((totalScore / examConfig.totalMarks) * 100);
            
            // Prepare result data
            const resultData = {
                student_id: currentStudent.id,
                english_score: scores[0],
                biology_score: scores[1],
                chemistry_score: scores[2],
                physics_score: scores[3],
                total_score: totalScore,
                percentage: percentage,
                answers: studentAnswers,
                time_taken: examConfig.duration - timeRemaining,
                submitted_at: new Date().toISOString()
            };
            
            try {
                // Save result to database
                const { data, error } = await supabase
                    .from('exam_results')
                    .insert([resultData])
                    .select();
                
                if (error) throw error;
                
                // Display results
                displayResults(scores, totalScore, percentage);
                showScreen('resultsScreen');
                
                // Clear local storage
                localStorage.removeItem('currentStudent');
                
            } catch (error) {
                console.error('Error saving results:', error);
                alert('Error submitting exam. Please try again.');
            }
        }

       function calculateScores() {
    const correctAnswers = [0, 0, 0, 0]; // Count correct answers per subject
    
    // Count correct answers for each subject
    questions.forEach((question, index) => {
        if (studentAnswers[index] === question.answer) {
            correctAnswers[question.subject]++;
        }
    });
    
    // Calculate percentage score for each subject (out of 100)
    const scores = examConfig.subjects.map((subject, index) => {
        return Math.round((correctAnswers[index] / subject.questions) * 100);
    });
    
    return scores;
}

        function displayResults(scores, totalScore, percentage) {
            const resultsContainer = document.getElementById('studentResults');
            
            // Performance level
            let performanceLevel = '';
            let performanceColor = '';
            
            if (percentage >= 80) {
                performanceLevel = 'Excellent';
                performanceColor = 'var(--success)';
            } else if (percentage >= 70) {
                performanceLevel = 'Very Good';
                performanceColor = 'var(--info)';
            } else if (percentage >= 60) {
                performanceLevel = 'Good';
                performanceColor = 'var(--accent)';
            } else if (percentage >= 50) {
                performanceLevel = 'Average';
                performanceColor = 'var(--warning)';
            } else {
                performanceLevel = 'Needs Improvement';
                performanceColor = 'var(--danger)';
            }
            
            resultsContainer.innerHTML = `
                <div class="performance-summary">
                    <h3>Examination Complete!</h3>
                    <div class="performance-level" style="color: ${performanceColor}">${performanceLevel}</div>
                    <div style="font-size: 2.5rem; font-weight: bold; margin: 10px 0;">${percentage}%</div>
                    <div>Total Score: ${totalScore} / ${examConfig.totalMarks}</div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h3><i class="fas fa-font"></i> English</h3>
                        <div class="stat-number">${scores[0]}%</div>
                    </div>
                    <div class="result-card">
                        <h3><i class="fas fa-dna"></i> Biology</h3>
                        <div class="stat-number">${scores[1]}%</div>
                    </div>
                    <div class="result-card">
                        <h3><i class="fas fa-flask"></i> Chemistry</h3>
                        <div class="stat-number">${scores[2]}%</div>
                    </div>
                    <div class="result-card">
                        <h3><i class="fas fa-atom"></i> Physics</h3>
                        <div class="stat-number">${scores[3]}%</div>
                    </div>
                </div>
                
                <div class="motivation-box">
                    <h3><i class="fas fa-lightbulb"></i> Performance Insight</h3>
                    <p>${getPerformanceInsight(percentage)}</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-info" onclick="showScreen('resultCheckerScreen')">
                        <i class="fas fa-chart-bar"></i> Detailed Analysis
                    </button>
                </div>
            `;
            
            // Add celebration effect for high scores
            if (percentage >= 80) {
                resultsContainer.classList.add('celebrate');
            }
        }

        // Calculator Functions
        function openCalculator() {
            document.getElementById('calculatorOverlay').style.display = 'flex';
        }

        function closeCalculator() {
            document.getElementById('calculatorOverlay').style.display = 'none';
        }

        function appendToDisplay(value) {
            const display = document.getElementById('calcDisplay');
            display.value += value;
        }

        function clearCalculator() {
            document.getElementById('calcDisplay').value = '';
        }

        function clearEntry() {
            const display = document.getElementById('calcDisplay');
            display.value = display.value.slice(0, -1);
        }

        function calculateResult() {
            const display = document.getElementById('calcDisplay');
            try {
                // Evaluate the expression safely
                display.value = eval(display.value);
            } catch (error) {
                display.value = 'Error';
            }
        }

        function memoryRecall() {
            document.getElementById('calcDisplay').value = calculatorMemory;
        }

        function memoryClear() {
            calculatorMemory = 0;
        }

        function memoryAdd() {
            const display = document.getElementById('calcDisplay');
            try {
                calculatorMemory += eval(display.value);
            } catch (error) {
                display.value = 'Error';
            }
        }

        function memorySubtract() {
            const display = document.getElementById('calcDisplay');
            try {
                calculatorMemory -= eval(display.value);
            } catch (error) {
                display.value = 'Error';
            }
        }

        function getPerformanceInsight(percentage) {
            if (percentage >= 80) {
                return "Outstanding performance! You have demonstrated excellent understanding of all subjects. Keep up the great work!";
            } else if (percentage >= 70) {
                return "Very good performance! You have a strong grasp of the material with some areas for improvement.";
            } else if (percentage >= 60) {
                return "Good performance! You understand the core concepts well but need to focus on some specific areas.";
            } else if (percentage >= 50) {
                return "Average performance. You have basic understanding but need more practice to improve your scores.";
            } else {
                return "You need to focus more on your studies. Identify your weak areas and practice regularly to improve.";
            }
        }

        // Load all results from database
        async function loadAllResults() {
            const container = document.getElementById('allResultsContainer');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading results from database...</div>';
            
            try {
                // Get all students with their results
                const { data: results, error } = await supabase
                    .from('exam_results')
                    .select(`
                        *,
                        students (
                            full_name,
                            registration_number
                        )
                    `)
                    .order('total_score', { ascending: false });
                
                if (error) throw error;
                
                if (!results || results.length === 0) {
                    container.innerHTML = '<div class="error">No examination results found in the database.</div>';
                    return;
                }
                
                // Calculate ranks
                results.forEach((result, index) => {
                    result.rank = index + 1;
                });
                
                // Display results in a table
                let tableHTML = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Name</th>
                                    <th>Reg No</th>
                                    <th>English</th>
                                    <th>Biology</th>
                                    <th>Chemistry</th>
                                    <th>Physics</th>
                                    <th>Total</th>
                                    <th>Percentage</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                results.forEach(result => {
                    const date = new Date(result.submitted_at).toLocaleDateString();
                    tableHTML += `
                        <tr>
                            <td>${result.rank}</td>
                            <td>${result.students.full_name}</td>
                            <td>${result.students.registration_number}</td>
                            <td>${result.english_score}</td>
                            <td>${result.biology_score}</td>
                            <td>${result.chemistry_score}</td>
                            <td>${result.physics_score}</td>
                            <td>${result.total_score}</td>
                            <td>${result.percentage}%</td>
                            <td>${date}</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-success" onclick="downloadResultsAsPDF()">
                            <i class="fas fa-file-pdf"></i> Download Results as PDF
                        </button>
                    </div>
                `;
                
                container.innerHTML = tableHTML;
                
            } catch (error) {
                console.error('Error loading results:', error);
                container.innerHTML = '<div class="error">Error loading results: ' + error.message + '</div>';
            }
        }

        // FIXED: Result Checker Function
        async function getStudentResult(registrationNumber) {
    try {
        // First get the student
        const { data: student, error: studentError } = await supabase
            .from('students')
            .select('*')
            .eq('registration_number', registrationNumber)
            .single();

        if (studentError || !student) {
            console.error('Student not found:', studentError);
            return null;
        }

        // Then get their exam results
        const { data: examResults, error: resultError } = await supabase
            .from('exam_results')
            .select('*')
            .eq('student_id', student.id);

        if (resultError || !examResults || examResults.length === 0) {
            console.error('Exam result not found:', resultError);
            return null;
        }

        // Combine the data
        return {
            ...student,
            exam_results: examResults
        };
        
    } catch (error) {
        console.error('Error in getStudentResult:', error);
        return null;
    }
}

        // FIXED: Check Result Function
        async function checkResult() {
            const regNumber = document.getElementById('resultRegNumber').value.trim();
            const output = document.getElementById('resultCheckerOutput');
            
            if (!regNumber) {
                output.innerHTML = '<div class="error"><i class="fas fa-exclamation-circle"></i> Please enter your registration number</div>';
                return;
            }
            
            output.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Searching for your results...</div>';
            
            try {
                const studentData = await getStudentResult(regNumber);
                
                if (!studentData) {
                    output.innerHTML = '<div class="error"><i class="fas fa-times-circle"></i> No results found for registration number: <strong>' + regNumber + '</strong>. Please check and try again.</div>';
                    return;
                }
                
                if (!studentData.exam_results || studentData.exam_results.length === 0) {
                    output.innerHTML = '<div class="error"><i class="fas fa-times-circle"></i> No examination results found for this registration number.</div>';
                    return;
                }
                
                const result = studentData.exam_results[0];
                displayResultAnalysis(studentData, result);
                
            } catch (error) {
                console.error('Error in checkResult:', error);
                output.innerHTML = '<div class="error"><i class="fas fa-exclamation-triangle"></i> Error fetching results: ' + error.message + '. Please try again.</div>';
            }
        }

        function displayResultAnalysis(student, result) {
            const output = document.getElementById('resultCheckerOutput');
            
            // Calculate subject performance
            const subjects = [
                { name: 'English Language', score: result.english_score, max: 100 },
                { name: 'Biology', score: result.biology_score, max: 100 },
                { name: 'Chemistry', score: result.chemistry_score, max: 100 },
                { name: 'Physics', score: result.physics_score, max: 100 }
            ];
            
            // Identify strengths and weaknesses
            const strengths = subjects.filter(subj => subj.score >= 70);
            const weaknesses = subjects.filter(subj => subj.score < 50);
            const averageSubjects = subjects.filter(subj => subj.score >= 50 && subj.score < 70);
            
            // Performance level
            let performanceLevel = '';
            if (result.percentage >= 80) performanceLevel = 'Excellent';
            else if (result.percentage >= 70) performanceLevel = 'Very Good';
            else if (result.percentage >= 60) performanceLevel = 'Good';
            else if (result.percentage >= 50) performanceLevel = 'Average';
            else performanceLevel = 'Needs Improvement';
            
            let analysisHTML = `
                <div class="performance-summary">
                    <h3><i class="fas fa-user-graduate"></i> Result Analysis for ${student.full_name}</h3>
                    <div class="performance-level">${performanceLevel}</div>
                    <div style="font-size: 2rem; font-weight: bold; margin: 10px 0;">${result.percentage}%</div>
                    <div>Registration Number: <strong>${student.registration_number}</strong></div>
                </div>
                
                <div class="result-analysis">
                    <div class="analysis-section">
                        <h3 class="section-title"><i class="fas fa-chart-bar"></i> Subject Performance</h3>
                        <div class="results-grid">
            `;
            
            // Add subject performance cards
            subjects.forEach(subject => {
                let cardClass = 'subject-card';
                if (subject.score >= 70) cardClass += ' strength-card';
                else if (subject.score < 50) cardClass += ' weakness-card';
                else cardClass += ' good-card';
                
                analysisHTML += `
                    <div class="${cardClass}">
                        <h4>${subject.name}</h4>
                        <div class="stat-number">${subject.score}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${subject.score}%"></div>
                        </div>
                    </div>
                `;
            });
            
            analysisHTML += `
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <h3 class="section-title"><i class="fas fa-trophy"></i> Strengths</h3>
            `;
            
            if (strengths.length > 0) {
                strengths.forEach(subject => {
                    analysisHTML += `<div class="subject-card strength-card">${subject.name}: ${subject.score}%</div>`;
                });
            } else {
                analysisHTML += `<p>No subjects with excellent performance. Focus on improving all areas.</p>`;
            }
            
            analysisHTML += `
                    </div>
                    
                    <div class="analysis-section">
                        <h3 class="section-title"><i class="fas fa-exclamation-triangle"></i> Areas Needing Improvement</h3>
            `;
            
            if (weaknesses.length > 0) {
                weaknesses.forEach(subject => {
                    analysisHTML += `<div class="subject-card weakness-card">${subject.name}: ${subject.score}%</div>`;
                });
            } else {
                analysisHTML += `<p>Good job! You don't have any critically weak subjects.</p>`;
            }
            
            analysisHTML += `
                    </div>
                    
                    <div class="analysis-section">
                        <h3 class="section-title"><i class="fas fa-lightbulb"></i> Study Recommendations</h3>
                        <ul class="tip-list">
            `;
            
            // Generate study recommendations based on performance
            if (weaknesses.length > 0) {
                analysisHTML += `<li>Focus more on your weaker subjects: ${weaknesses.map(s => s.name).join(', ')}</li>`;
                analysisHTML += `<li>Allocate more study time to these subjects and practice with past questions</li>`;
            }
            
            if (averageSubjects.length > 0) {
                analysisHTML += `<li>Maintain consistent practice in ${averageSubjects.map(s => s.name).join(', ')} to reach excellent level</li>`;
            }
            
            if (strengths.length > 0) {
                analysisHTML += `<li>Keep up the good work in ${strengths.map(s => s.name).join(', ')} - these are your strong areas</li>`;
            }
            
            analysisHTML += `
                            <li>Practice time management during exams</li>
                            <li>Review incorrect answers to understand your mistakes</li>
                            <li>Take regular mock tests to track your progress</li>
                        </ul>
                    </div>
                    
                    <div class="motivation-box">
                        <h3><i class="fas fa-star"></i> Final Recommendation</h3>
                        <p>${getFinalRecommendation(result.percentage)}</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn print-btn" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Result
                    </button>
                </div>
            `;
            
            output.innerHTML = analysisHTML;
        }

        function getFinalRecommendation(percentage) {
            if (percentage >= 80) {
                return "Excellent performance! You're well prepared for the actual JAMB examination. Continue with your current study pattern and focus on maintaining this high standard.";
            } else if (percentage >= 70) {
                return "Very good performance! You have a strong foundation. Focus on your weaker areas to reach excellence level.";
            } else if (percentage >= 60) {
                return "Good performance. You're on the right track but need more consistent practice, especially in your weaker subjects.";
            } else if (percentage >= 50) {
                return "Average performance. You need to intensify your studies, particularly in subjects where you scored below average.";
            } else {
                return "You need to significantly improve your preparation. Consider getting a tutor or joining a study group to help with difficult topics.";
            }
        }

        // Admin functions
        async function handleAdminLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('adminError');
            
            // Simple admin authentication (in a real app, this would be more secure)
            if (email === 'admin@sirkacademy.com' && password === 'JAMB2026') {
    showScreen('adminDashboard');
    await loadAdminDashboard();
} else {
                errorDiv.textContent = 'Invalid admin credentials.';
                errorDiv.classList.remove('hidden');
            }
        }

      function logoutAdmin() {
    // Clear any admin session data
    localStorage.removeItem('adminLoggedIn');
    
    // Show confirmation message
    showNotification('success', 'Admin logged out successfully');
    
    // Return to welcome screen
    showScreen('welcomeScreen');
    
    // Clear admin form fields
    document.getElementById('adminEmail').value = '';
    document.getElementById('adminPassword').value = '';
    document.getElementById('adminError').classList.add('hidden');
}

        async function loadAdminStats() {
            try {
                // Get total students
                const { data: students, error: studentsError } = await supabase
                    .from('students')
                    .select('*');
                
                if (studentsError) throw studentsError;
                
                // Get total exam results
                const { data: results, error: resultsError } = await supabase
                    .from('exam_results')
                    .select('*');
                
                if (resultsError) throw resultsError;
                
                // Calculate average score
                const avgScore = results.length > 0 ? 
                    Math.round(results.reduce((sum, result) => sum + result.percentage, 0) / results.length) : 0;
                
                // Calculate top score
                const topScore = results.length > 0 ? 
                    Math.max(...results.map(result => result.percentage)) : 0;
                
                // Update stats
                document.getElementById('totalStudents').textContent = students?.length || 0;
                document.getElementById('totalExams').textContent = results?.length || 0;
                document.getElementById('avgScore').textContent = avgScore + '%';
                document.getElementById('topScore').textContent = topScore + '%';
                
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

async function loadAdminDashboard() {
            try {
                // Show loading indicator
                document.getElementById('adminResultsContainer').innerHTML = 
                    '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading dashboard...</div>';
                
                // Load all admin data
                await loadAdminStats();
                await loadActiveUsersStats();
                await loadAdminResults();
                
                console.log('Admin dashboard loaded successfully');
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
                document.getElementById('adminResultsContainer').innerHTML = 
                    '<div class="error">Error loading dashboard: ' + error.message + '</div>';
            }
        }

        // Active Users Statistics Function
        async function loadActiveUsersStats() {
            try {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString();
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString();
                const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()).toISOString();
                const yearStart = new Date(now.getFullYear(), 0, 1).toISOString();
                
                const { count: todayCount } = await supabase
                    .from('students')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', today);
                
                const { count: weekCount } = await supabase
                    .from('students')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', weekAgo);
                
                const { count: monthCount } = await supabase
                    .from('students')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', monthAgo);
                
                const { count: yearCount } = await supabase
                    .from('students')
                    .select('*', { count: 'exact', head: true })
                    .gte('created_at', yearStart);
                
                document.getElementById('activeToday').textContent = todayCount || 0;
                document.getElementById('activeWeek').textContent = weekCount || 0;
                document.getElementById('activeMonth').textContent = monthCount || 0;
                document.getElementById('activeYear').textContent = yearCount || 0;
            } catch (error) {
                console.error('Error loading active users:', error);
            }
        }

        async function loadAdminResults() {
            const container = document.getElementById('adminResultsContainer');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading admin data...</div>';
            
            try {
                // Get all students with their results
                const { data: results, error } = await supabase
                    .from('exam_results')
                    .select(`
                        *,
                        students (
                            id,
                            full_name,
                            email,
                            phone,
                            registration_number
                        )
                    `)
                    .order('submitted_at', { ascending: false });
                
                if (error) throw error;
                
                if (!results || results.length === 0) {
                    container.innerHTML = '<div class="error">No examination results found.</div>';
                    return;
                }
                
                let tableHTML = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Reg No</th>
                                    <th>English</th>
                                    <th>Biology</th>
                                    <th>Chemistry</th>
                                    <th>Physics</th>
                                    <th>Total</th>
                                    <th>Percentage</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                results.forEach((result, index) => {
                    const date = new Date(result.submitted_at).toLocaleDateString();
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${result.students.full_name}</td>
                            <td>${result.students.email}</td>
                            <td>${result.students.registration_number}</td>
                            <td>${result.english_score}</td>
                            <td>${result.biology_score}</td>
                            <td>${result.chemistry_score}</td>
                            <td>${result.physics_score}</td>
                            <td>${result.total_score}</td>
                            <td>${result.percentage}%</td>
                            <td>${date}</td>
                          <td>
    <div class="action-buttons">
        <button class="btn btn-sm btn-danger" onclick="confirmDeleteResult('${result.id}', '${result.student_id}', '${result.students.full_name.replace(/'/g, "\\'")}')">
            <i class="fas fa-trash"></i> Delete
        </button>
    </div>
</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                container.innerHTML = tableHTML;
                
                // Add search functionality
                const searchBox = document.getElementById('searchStudents');
                searchBox.addEventListener('input', filterAdminResults);
                
            } catch (error) {
                console.error('Error loading admin results:', error);
                container.innerHTML = '<div class="error">Error loading results: ' + error.message + '</div>';
            }
        }

        function filterAdminResults() {
            const searchTerm = document.getElementById('searchStudents').value.toLowerCase();
            const rows = document.querySelectorAll('#adminResultsContainer tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

         // ==================== DELETE FUNCTIONS ====================

// Show modal helper
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
    }
}

// Close modal helper
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
    }
}

// Individual Delete Function
async function confirmDeleteResult(resultId, studentId, studentName) {
    console.log('Delete initiated:', resultId, studentId, studentName);
    
    document.getElementById('deleteConfirmText').textContent = 
        `Are you sure you want to delete ${studentName}'s result? This action cannot be undone.`;
    
    showModal('deleteConfirmModal');
    
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    const newConfirmBtn = confirmBtn.cloneNode(true);
    confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
    
    newConfirmBtn.addEventListener('click', async function() {
        try {
            newConfirmBtn.disabled = true;
            newConfirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
            
            // Delete exam result
            const { error: resultError } = await supabase
                .from('exam_results')
                .delete()
                .eq('id', resultId);
            
            if (resultError) throw new Error('Failed to delete exam result: ' + resultError.message);
            
            // Delete student
            const { error: studentError } = await supabase
                .from('students')
                .delete()
                .eq('id', studentId);
            
            if (studentError) throw new Error('Failed to delete student record: ' + studentError.message);
            
            closeModal('deleteConfirmModal');
            showNotification('success', 'Student record deleted successfully!');
            
            // Reload data
            await Promise.all([
                loadAdminResults(),
                loadAdminStats(),
                loadActiveUsersStats()
            ]);
            
        } catch (error) {
            console.error('Delete error:', error);
            closeModal('deleteConfirmModal');
            showNotification('error', 'Error: ' + error.message);
        } finally {
            newConfirmBtn.disabled = false;
            newConfirmBtn.innerHTML = 'Delete';
        }
    });
}

// Bulk Delete All Results Function
async function confirmDeleteAllResults() {
    try {
        // Get count first to show in confirmation
        const { count, error: countError } = await supabase
            .from('exam_results')
            .select('*', { count: 'exact', head: true });
        
        if (countError) throw countError;
        
        if (!count || count === 0) {
            showNotification('error', 'No results found to delete');
            return;
        }
        
        document.getElementById('deleteConfirmText').textContent = 
            `⚠️ WARNING: You are about to delete ALL ${count} student results. This action CANNOT be undone. Are you absolutely sure?`;
        
        showModal('deleteConfirmModal');
        
        const confirmBtn = document.getElementById('confirmDeleteBtn');
        const newConfirmBtn = confirmBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
        
        // Change button color to red for bulk delete
        newConfirmBtn.style.background = '#D32F2F';
        newConfirmBtn.textContent = 'DELETE ALL RESULTS';
        
        newConfirmBtn.addEventListener('click', async function() {
            try {
                newConfirmBtn.disabled = true;
                newConfirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting All...';
                
                // Delete all exam results first (use proper Supabase delete syntax)
                const { error: resultsError } = await supabase
                    .from('exam_results')
                    .delete()
                    .not('id', 'is', null); // Proper way to delete all records
                
                if (resultsError) throw new Error('Failed to delete exam results: ' + resultsError.message);
                
                // Delete all students
                const { error: studentsError } = await supabase
                    .from('students')
                    .delete()
                    .not('id', 'is', null); // Proper way to delete all records
                
                if (studentsError) throw new Error('Failed to delete students: ' + studentsError.message);
                
                closeModal('deleteConfirmModal');
                showNotification('success', `All ${count} results deleted successfully!`);
                
                // Reload data
                await Promise.all([
                    loadAdminResults(),
                    loadAdminStats(),
                    loadActiveUsersStats()
                ]);
                
            } catch (error) {
                console.error('Bulk delete error:', error);
                closeModal('deleteConfirmModal');
                showNotification('error', 'Error: ' + error.message);
            } finally {
                newConfirmBtn.disabled = false;
                newConfirmBtn.innerHTML = 'DELETE ALL RESULTS';
                newConfirmBtn.style.background = '#F44336';
            }
        });
        
    } catch (error) {
        console.error('Error in confirmDeleteAllResults:', error);
        showNotification('error', 'Error: ' + error.message);
    }
}

// ==================== DELETE FUNCTIONS ====================

// Show modal helper
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
    }
}

// Close modal helper
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
    }
}

// Notification Helper
function showNotification(type, message) {
    const notification = document.createElement('div');
    notification.className = type === 'success' ? 'success' : 'error';
    notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '10000';
    notification.style.padding = '15px 20px';
    notification.style.borderRadius = '6px';
    notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
    notification.style.minWidth = '250px';
    notification.style.animation = 'slideIn 0.3s ease';
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// ==================== END DELETE FUNCTIONS ====================

        function editStudentResult(resultId) {
            // Implementation for editing student results
            alert('Edit functionality would be implemented here for result ID: ' + resultId);
        }

  // FIXED: Individual Delete Function
async function confirmDeleteResult(resultId, studentId, studentName) {
    console.log('Delete initiated:', resultId, studentId, studentName);
    
    // Update modal text
    document.getElementById('deleteConfirmText').textContent = 
        `Are you sure you want to delete ${studentName}'s result? This action cannot be undone.`;
    
    // Show the modal
    showModal('deleteConfirmModal');
    
    // Remove any existing event listeners by completely replacing the button
    const oldConfirmBtn = document.getElementById('confirmDeleteBtn');
    const newConfirmBtn = oldConfirmBtn.cloneNode(true);
    oldConfirmBtn.parentNode.replaceChild(newConfirmBtn, oldConfirmBtn);
    
    // Reset button styling for individual delete
    newConfirmBtn.style.background = '';
    newConfirmBtn.textContent = 'Delete';
    
    // Add ONE-TIME click handler
    const handleDelete = async function() {
        try {
            console.log('Starting deletion process...');
            newConfirmBtn.disabled = true;
            newConfirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
            
            // Delete exam result first
            console.log('Deleting exam result:', resultId);
            const { error: resultError } = await supabase
                .from('exam_results')
                .delete()
                .eq('id', resultId);
            
            if (resultError) {
                console.error('Result deletion error:', resultError);
                throw new Error('Failed to delete exam result: ' + resultError.message);
            }
            
            console.log('Exam result deleted successfully, now deleting student:', studentId);
            
            // Delete student record
            const { error: studentError } = await supabase
                .from('students')
                .delete()
                .eq('id', studentId);
            
            if (studentError) {
                console.error('Student deletion error:', studentError);
                throw new Error('Failed to delete student record: ' + studentError.message);
            }
            
            console.log('Student deleted successfully');
            
            // Close modal and show success
            closeModal('deleteConfirmModal');
            showNotification('success', 'Student record deleted successfully!');
            
            // Reload all data
            await loadAdminResults();
            await loadAdminStats();
            await loadActiveUsersStats();
            
        } catch (error) {
            console.error('Delete error:', error);
            closeModal('deleteConfirmModal');
            showNotification('error', 'Error: ' + error.message);
        }
    };
    
    // Attach the event listener
    newConfirmBtn.addEventListener('click', handleDelete);
}



       async function downloadResultsAsPDF() {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Get all results
        const { data: results, error } = await supabase
            .from('exam_results')
            .select(`
                *,
                students (
                    full_name,
                    registration_number
                )
            `)
            .order('total_score', { ascending: false });
        
        if (error) throw error;
        
        // Add title
        doc.setFontSize(18);
        doc.text('SIRKACADEMY - JAMB UTME 2026 Results', 105, 15, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text('Examination Results Summary', 105, 25, { align: 'center' });
        
        // Prepare table data
        const tableData = results.map((result, index) => [
            index + 1,
            result.students.full_name,
            result.students.registration_number,
            result.english_score,
            result.biology_score,
            result.chemistry_score,
            result.physics_score,
            result.total_score,
            result.percentage + '%',
            new Date(result.submitted_at).toLocaleDateString()
        ]);
        
        // Add table
        doc.autoTable({
            startY: 35,
            head: [['Rank', 'Name', 'Reg No', 'English', 'Biology', 'Chemistry', 'Physics', 'Total', '%', 'Date']],
            body: tableData,
            theme: 'grid',
            styles: { fontSize: 8, cellPadding: 2 },
            headStyles: { fillColor: [21, 101, 192], textColor: 255 }
        });
        
        // Add footer
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(10);
            doc.text(`Page ${i} of ${pageCount}`, 105, doc.internal.pageSize.height - 10, { align: 'center' });
            doc.text('Generated by SIRKACADEMY', 105, doc.internal.pageSize.height - 5, { align: 'center' });
        }
        
        // Save PDF
        doc.save('JAMB_UTME_2026_Results.pdf');
        
    } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Error generating PDF: ' + error.message);
    }
}

async function downloadAllResultsAsPDF() {
    try {
        // Check if jsPDF is loaded
        if (typeof window.jspdf === 'undefined') {
            alert('PDF library not loaded. Please refresh the page and try again.');
            return;
        }
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            orientation: 'landscape',
            unit: 'mm',
            format: 'a4'
        });
        
        // Show loading message
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'success';
        loadingDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
        loadingDiv.style.position = 'fixed';
        loadingDiv.style.top = '20px';
        loadingDiv.style.right = '20px';
        loadingDiv.style.zIndex = '9999';
        loadingDiv.style.padding = '15px 20px';
        document.body.appendChild(loadingDiv);
        
        // Get all results
        const { data: results, error } = await supabase
            .from('exam_results')
            .select(`
                *,
                students (
                    id,
                    full_name,
                    email,
                    phone,
                    registration_number
                )
            `)
            .order('submitted_at', { ascending: false });
        
        if (error) throw error;
        
        if (!results || results.length === 0) {
            loadingDiv.remove();
            alert('No results found to download.');
            return;
        }
        
        // Add title
        doc.setFontSize(20);
        doc.setFont(undefined, 'bold');
        doc.text('SIRKACADEMY - JAMB UTME 2026', doc.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
        
        doc.setFontSize(14);
        doc.setFont(undefined, 'normal');
        doc.text('Complete Student Records (Admin)', doc.internal.pageSize.getWidth() / 2, 25, { align: 'center' });
        
        doc.setFontSize(10);
        doc.text(`Total Students: ${results.length}`, doc.internal.pageSize.getWidth() / 2, 32, { align: 'center' });
        doc.text(`Generated: ${new Date().toLocaleString()}`, doc.internal.pageSize.getWidth() / 2, 38, { align: 'center' });
        
        // Prepare table data
        const tableData = results.map((result, index) => [
            index + 1,
            result.students.full_name,
            result.students.email,
            result.students.registration_number,
            result.english_score + '%',
            result.biology_score + '%',
            result.chemistry_score + '%',
            result.physics_score + '%',
            result.total_score,
            result.percentage + '%',
            new Date(result.submitted_at).toLocaleDateString()
        ]);
        
        // Add table using autoTable
        doc.autoTable({
            startY: 45,
            head: [['#', 'Name', 'Email', 'Reg No', 'Eng', 'Bio', 'Chem', 'Phy', 'Total', '%', 'Date']],
            body: tableData,
            theme: 'striped',
            styles: { 
                fontSize: 8, 
                cellPadding: 2,
                overflow: 'linebreak'
            },
            headStyles: { 
                fillColor: [21, 101, 192], 
                textColor: 255, 
                fontStyle: 'bold',
                halign: 'center'
            },
            columnStyles: {
                0: { cellWidth: 10, halign: 'center' },
                1: { cellWidth: 35 },
                2: { cellWidth: 45 },
                3: { cellWidth: 25, halign: 'center' },
                4: { cellWidth: 15, halign: 'center' },
                5: { cellWidth: 15, halign: 'center' },
                6: { cellWidth: 15, halign: 'center' },
                7: { cellWidth: 15, halign: 'center' },
                8: { cellWidth: 18, halign: 'center' },
                9: { cellWidth: 18, halign: 'center' },
                10: { cellWidth: 25, halign: 'center' }
            },
            didDrawPage: function(data) {
                // Footer
                doc.setFontSize(9);
                const pageCount = doc.internal.getNumberOfPages();
                const currentPage = doc.internal.getCurrentPageInfo().pageNumber;
                doc.text(
                    `Page ${currentPage} of ${pageCount}`, 
                    doc.internal.pageSize.getWidth() / 2, 
                    doc.internal.pageSize.getHeight() - 10, 
                    { align: 'center' }
                );
                doc.setFontSize(8);
                doc.text(
                    'SIRKACADEMY - Confidential Admin Report', 
                    doc.internal.pageSize.getWidth() / 2, 
                    doc.internal.pageSize.getHeight() - 5, 
                    { align: 'center' }
                );
            }
        });
        
        // Save PDF
        const filename = `JAMB_Admin_Report_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(filename);
        
        // Remove loading message and show success
        loadingDiv.remove();
        const successDiv = document.createElement('div');
        successDiv.className = 'success';
        successDiv.innerHTML = '<i class="fas fa-check-circle"></i> PDF downloaded successfully!';
        successDiv.style.position = 'fixed';
        successDiv.style.top = '20px';
        successDiv.style.right = '20px';
        successDiv.style.zIndex = '9999';
        successDiv.style.padding = '15px 20px';
        document.body.appendChild(successDiv);
        
        setTimeout(() => {
            successDiv.remove();
        }, 3000);
        
    } catch (error) {
        console.error('Error generating admin PDF:', error);
        alert('Error generating PDF: ' + error.message);
    }
}

      // Make functions globally available
window.showScreen = showScreen;
window.previousQuestion = previousQuestion;
window.nextQuestion = nextQuestion;
window.flagQuestion = flagQuestion;
window.submitExam = submitExam;
window.checkResult = checkResult;
window.logoutAdmin = logoutAdmin;
window.downloadResultsAsPDF = downloadResultsAsPDF;
window.downloadAllResultsAsPDF = downloadAllResultsAsPDF;
window.editStudentResult = editStudentResult;
window.confirmDeleteResult = confirmDeleteResult;
window.closeModal = closeModal;
window.calculateAggregate = calculateAggregate; // Add this

// Calculator Functions
let calculatorExpression = '';
let calculatorResult = '0';

function calcAppend(value) {
    if (calculatorResult === '0' && value !== '.') {
        calculatorExpression = value;
    } else {
        calculatorExpression += value;
    }
    updateCalculatorDisplay();
}

function calcClear() {
    calculatorExpression = '';
    calculatorResult = '0';
    updateCalculatorDisplay();
}

function calcBackspace() {
    calculatorExpression = calculatorExpression.slice(0, -1);
    if (calculatorExpression === '') {
        calculatorResult = '0';
    }
    updateCalculatorDisplay();
}

function calcCalculate() {
    try {
        // Replace mathematical symbols for eval
        let expression = calculatorExpression
            .replace(/×/g, '*')
            .replace(/÷/g, '/')
            .replace(/−/g, '-');
        
        // Evaluate the expression
        calculatorResult = eval(expression).toString();
        calculatorExpression = calculatorResult;
        updateCalculatorDisplay();
    } catch (error) {
        calculatorResult = 'Error';
        updateCalculatorDisplay();
        setTimeout(() => {
            calcClear();
        }, 1500);
    }
}

function calcFunction(func) {
    try {
        let currentValue = parseFloat(calculatorExpression) || 0;
        let result;
        
        switch(func) {
            case 'sqrt':
                result = Math.sqrt(currentValue);
                break;
            case 'square':
                result = currentValue * currentValue;
                break;
            case 'sin':
                result = Math.sin(currentValue * Math.PI / 180);
                break;
            case 'cos':
                result = Math.cos(currentValue * Math.PI / 180);
                break;
            case 'tan':
                result = Math.tan(currentValue * Math.PI / 180);
                break;
            case 'log':
                result = Math.log10(currentValue);
                break;
            default:
                result = currentValue;
        }
        
        calculatorResult = result.toString();
        calculatorExpression = calculatorResult;
        updateCalculatorDisplay();
    } catch (error) {
        calculatorResult = 'Error';
        updateCalculatorDisplay();
        setTimeout(() => {
            calcClear();
        }, 1500);
    }
}

function updateCalculatorDisplay() {
    const display = document.getElementById('calculatorDisplay');
    display.textContent = calculatorExpression || calculatorResult;
}

// Add calculator functions to global scope
window.calcAppend = calcAppend;
window.calcClear = calcClear;
window.calcBackspace = calcBackspace;
window.calcCalculate = calcCalculate;
window.calcFunction = calcFunction;

// Make delete functions globally available
window.confirmDeleteResult = confirmDeleteResult;
window.confirmDeleteAllResults = confirmDeleteAllResults;
window.showModal = showModal;
window.closeModal = closeModal;
window.showNotification = showNotification;
    </script>
</body>
</html>